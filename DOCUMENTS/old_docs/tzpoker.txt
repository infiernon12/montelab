2. Требования к базе данных
2.1. Структура таблицы лицензий
sql
CREATE TABLE licenses (
    id SERIAL PRIMARY KEY,
    hwid TEXT UNIQUE NOT NULL,
    comment TEXT,
    valid_until TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    hwid_updated TIMESTAMP
);

CREATE UNIQUE INDEX unique_non_null_comment 
ON licenses (comment) WHERE comment IS NOT NULL;
2.2. Обязательные SQL-запросы
Система должна поддерживать следующие операции:

Добавление новой лицензии

Проверка статуса лицензии по HWID

Продление подписки

Принудительное отключение лицензии

Удаление лицензии

Обновление HWID для существующей лицензии

Вывод списка активных/просроченных лицензий

3. Требования к API серверу
3.1. Безопасность соединения
Обязательное использование HTTPS

Реализация SSL pinning на клиенте

Валидация сертификата сервера на клиенте

3.2. Endpoint: Проверка лицензии
URL: POST /api/v1/license/check

Аутентификация: HMAC подпись запроса

Входные параметры:

json
{
  "hwid": "string",
  "timestamp": "integer (UNIX time)",
  "nonce": "string (случайные 6-12 чисел)"
}
3.3. Endpoint: Информация о лицензии (админский)
URL: POST /api/v1/license/info

Аутентификация: HMAC подпись + API ключ

Назначение: Получение полной информации о лицензии

4. Требования к клиентской части
4.1. Генерация HWID
Алгоритм должен использовать устойчивые идентификаторы оборудования:

Serial number системного диска

ID процессора

MAC-адрес основного сетевого интерфейса

Другие уникальные идентификаторы системы (чем больше, тем сложнее подделать и понять)

Если можно, то добавить в генерацию какой-то спрятанный параметр, например "qpkeo2k2ok2kmdkd2"

4.2. Механизм подписи запросов
Использование HMAC-SHA256 для подписи

Секретный ключ должен быть обфусцирован в коде клиента

Каждый запрос должен содержать:

Актуальную временную метку

Уникальный nonce для предотвращения replay-атак

4.3. Защита клиентского кода
Обфускация критических участков кода

Анти-отладочные механизмы

Проверка целостности исполняемого файла

Детект виртуальных машин и отладочных сред

5. Протокол взаимодействия

5.1. Последовательность работы
Клиент генерирует HWID при первом запуске

Пользователь предоставляет HWID для активации

Администратор добавляет HWID и уникальный логин в базу данных

Клиент периодически проверяет статус лицензии через API (например раз в час)

При истечении лицензии доступ блокируется (после проверки статуса лицензии)

5.2. Обработка ошибок
Система должна обрабатывать:

Отсутствие интернет-соединения

Невалидную подпись запроса

Просроченную временную метку

Повторное использование nonce

Несуществующий HWID в базе

6. Требования к безопасности
6.1. Защита от взлома
Отказ от хранения логики проверки на клиенте

Использование только server-side валидации

Регулярное обновление механизмов обфускации

6.2. Мониторинг и логирование
Логирование всех запросов к API

Мониторинг подозрительной активности

Система оповещения о множественных запросах с одного HWID

(на это можно положить, но в дальнейшем - это ебейшая штука)

7. Этапы внедрения
Развертывание базы данных и API сервера

Реализация механизма генерации HWID на клиенте

Внедрение HMAC-аутентификации в API

Добавление механизмов защиты клиентского кода

Тестирование работы системы под нагрузкой

8. Критерии приемки
Отсутствие ложных срабатываний блокировки

Стабильная работа при отсутствии интернета (grace period - думаю сделать около 2-4 часов, на случай, если ляжет сервер, хотя это импосибл)

Невозможность обхода проверки лицензии

Соответствие требованиям производительности