"""
–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ABC —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è analysis_service.py
–° —É—á–µ—Ç–æ–º: board texture, –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤, —Å—Ç–∞–¥–∏–∏ —É–ª–∏—Ü—ã, –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–π –∏–≥—Ä—ã
"""

from typing import Dict, List
from core.domain import Card, GameState, GameStage


class ImprovedRecommendationEngine:
    """
    –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ABC —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å —É—á–µ—Ç–æ–º:
    - Board texture compatibility —Å —Ä—É–∫–æ–π –∏–≥—Ä–æ–∫–∞
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤ (multiway vs heads-up)
    - –°—Ç–∞–¥–∏—è –∏–≥—Ä—ã (flop/turn/river)
    - –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã (–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    - –°–æ–≤–µ—Ç—ã –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ (–¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    """
    
    # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
    MONSTER_HANDS = {'straight_flush', 'four_kind', 'full_house'}
    STRONG_HANDS = {'flush', 'straight'}
    MEDIUM_HANDS = {'three_kind', 'two_pair'}
    WEAK_MADE_HANDS = {'one_pair'}
    
    def generate_recommendation(
        self,
        current_hand: str,
        win_rate: float,
        total_outs: int,
        outs_breakdown: Dict[str, int],
        texture_analysis: Dict,
        num_opponents: int,
        stage: GameStage,
        board_cards: List[Card]
    ) -> str:
        """
        –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        """
        
        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ä—É–∫–∏
        hand_type = self._normalize_hand_name(current_hand)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä—É–∫–∏
        hand_category = self._categorize_hand(hand_type)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä—É–∫–∏ —Å —Ç–µ–∫—Å—Ç—É—Ä–æ–π –±–æ—Ä–¥–∞
        texture_match = self._check_texture_compatibility(hand_type, texture_analysis, board_cards)
        
        # –ë–∞–∑–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏–ª—ã
        if hand_category == 'monster':
            return self._recommend_monster(
                hand_type, win_rate, texture_analysis, 
                num_opponents, stage, texture_match
            )
        
        elif hand_category == 'strong':
            return self._recommend_strong(
                hand_type, win_rate, texture_analysis, 
                num_opponents, stage, texture_match, outs_breakdown
            )
        
        elif hand_category == 'medium':
            return self._recommend_medium(
                hand_type, win_rate, texture_analysis, 
                num_opponents, stage, texture_match, total_outs
            )
        
        elif hand_category == 'weak_made':
            return self._recommend_weak_made(
                hand_type, win_rate, texture_analysis, 
                num_opponents, stage, total_outs, outs_breakdown
            )
        
        else:  # draw / no made hand
            return self._recommend_draw(
                total_outs, outs_breakdown, win_rate, 
                texture_analysis, num_opponents, stage
            )
    
    def _normalize_hand_name(self, hand_name: str) -> str:
        """–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–π"""
        hand_map = {
            'straight flush': 'straight_flush',
            'four of a kind': 'four_kind',
            'full house': 'full_house',
            'three of a kind': 'three_kind',
            'two pair': 'two_pair',
            'one pair': 'one_pair',
            'high card': 'high_card'
        }
        return hand_map.get(hand_name.lower(), hand_name.lower())
    
    def _categorize_hand(self, hand_type: str) -> str:
        """–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä—É–∫–∏"""
        if hand_type in self.MONSTER_HANDS:
            return 'monster'
        elif hand_type in self.STRONG_HANDS:
            return 'strong'
        elif hand_type in self.MEDIUM_HANDS:
            return 'medium'
        elif hand_type in self.WEAK_MADE_HANDS:
            return 'weak_made'
        else:
            return 'draw'
    
    def _check_texture_compatibility(
        self, 
        hand_type: str, 
        texture: Dict,
        board_cards: List[Card]
    ) -> Dict[str, bool]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —É—Å–∏–ª–∏–≤–∞–µ—Ç –ª–∏ —Ç–µ–∫—Å—Ç—É—Ä–∞ –±–æ—Ä–¥–∞ –Ω–∞—à—É —Ä—É–∫—É
        –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç—å
        """
        return {
            'flush_compatible': hand_type == 'flush' and texture.get('monotone', False),
            'straight_compatible': hand_type == 'straight' and texture.get('coordinated', False),
            'set_compatible': hand_type == 'three_kind' and not texture.get('paired', False),
            'fullhouse_compatible': hand_type == 'full_house' and texture.get('paired', False),
            
            'flush_danger': texture.get('monotone', False) and hand_type != 'flush',
            'straight_danger': texture.get('coordinated', False) and hand_type not in ['straight', 'flush', 'full_house'],
            'pair_danger': texture.get('paired', False) and hand_type not in ['full_house', 'four_kind']
        }
    
    # ===================== MONSTER HANDS =====================
    
    def _recommend_monster(
        self, 
        hand_type: str, 
        win_rate: float,
        texture: Dict,
        num_opponents: int,
        stage: GameStage,
        texture_match: Dict
    ) -> str:
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –º–æ–Ω—Å—Ç—Ä-—Ä—É–∫"""
        
        base = "üíé **–ú–û–ù–°–¢–†-–†–£–ö–ê**\n\n"
        
        # –ö–≤–∞–¥—Å
        if hand_type == 'four_kind':
            base += "üî• **–ö–∞—Ä–µ** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–ø–æ–±–µ–¥–∏–º–∞—è —Ä—É–∫–∞!\n"
            base += "‚úÖ **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ê–ì–†–ï–°–°–ò–Ø**: –°—Ç—Ä–æ–∏–º –æ–≥—Ä–æ–º–Ω—ã–π –±–∞–Ω–∫ –ª—é–±–æ–π —Ü–µ–Ω–æ–π.\n\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ù–∞ –≤—Å–µ—Ö —É–ª–∏—Ü–∞—Ö: –†–µ–π–∑/3-–±–µ—Ç/4-–±–µ—Ç\n"
            base += "‚Ä¢ –ù–∞ —Ä–∏–≤–µ—Ä–µ: –û–≤–µ—Äbet –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ value\n"
            base += "‚Ä¢ –ü—Ä–æ—Ç–∏–≤ 1 –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞: –í–æ–∑–º–æ–∂–µ–Ω small bet –¥–ª—è –∏–Ω–¥—É—Å–∞ –∫–æ–ª–ª–∞\n"
            base += f"‚Ä¢ –ü—Ä–æ—Ç–∏–≤ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: –ö—Ä—É–ø–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ —Å—Ä–∞–∑—É\n\n"
            
            base += self._add_positional_advice(
                "–ú–æ–∂–Ω–æ slow-play –Ω–∞ —Ñ–ª–æ–ø–µ –¥–ª—è trap",
                "–†–µ–π–∑ –Ω–∞ —Ñ–ª–æ–ø–µ, —á—Ç–æ–±—ã –Ω–µ –¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–∞—Ä—Ç"
            )
            return base
        
        # –§—É–ª–ª-—Ö–∞—É—Å
        elif hand_type == 'full_house':
            base += "üè† **–§—É–ª–ª-—Ö–∞—É—Å** - –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è —Ä—É–∫–∞!\n"
            
            if texture_match['fullhouse_compatible']:
                base += "‚úÖ –ü–∞—Ä–Ω—ã–π –±–æ—Ä–¥ —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à—É —Ä—É–∫—É - –æ–ø–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –º–µ–Ω—å—à–∏–π —Ñ—É–ª–ª-—Ö–∞—É—Å.\n\n"
            else:
                base += "‚ö†Ô∏è –§—É–ª–ª-—Ö–∞—É—Å –Ω–∞ –Ω–µ–ø–∞—Ä–Ω–æ–º –±–æ—Ä–¥–µ - –æ–ø–ø–æ–Ω–µ–Ω—Ç—ã –≤—Ä—è–¥ –ª–∏ –∑–∞–ø–æ–¥–æ–∑—Ä—è—Ç —Å–∏–ª—É.\n\n"
            
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ù–∞ —Ñ–ª–æ–ø–µ/—Ç–µ—Ä–Ω–µ: –°—Ä–µ–¥–Ω–∏–π bet –¥–ª—è value\n"
            base += "‚Ä¢ –ù–∞ —Ä–∏–≤–µ—Ä–µ: –ö—Ä—É–ø–Ω—ã–π value bet\n"
            
            if num_opponents == 1:
                base += "‚Ä¢ Heads-up: –ú–æ–∂–Ω–æ —á–µ–∫-—Ä–µ–π–∑ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏\n"
            else:
                base += f"‚Ä¢ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: –ü—Ä—è–º—ã–µ —Å—Ç–∞–≤–∫–∏ (–∫—Ç–æ-—Ç–æ –∑–∞–ø–ª–∞—Ç–∏—Ç)\n"
            
            base += "\n" + self._add_opponent_behavior_advice(**{
                "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "–ß–µ–∫-—Ä–µ–π–∑ –Ω–∞ —Ä–∏–≤–µ—Ä–µ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ value",
                "–ø–∞—Å—Å–∏–≤–µ–Ω": "–ö—Ä—É–ø–Ω–∞—è –¥–æ–Ω–∫-—Å—Ç–∞–≤–∫–∞, —á—Ç–æ–±—ã –≤–∑—è—Ç—å value",
                "—Ç–∞–π—Ç–æ–≤": "–°—Ä–µ–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞ - –æ–Ω–∏ –ø–ª–∞—Ç—è—Ç —Ç–æ–ª—å–∫–æ —Å —Å–∏–ª—å–Ω—ã–º–∏ —Ä—É–∫–∞–º–∏"
            })
            return base
        
        # –°—Ç—Ä–∏—Ç-—Ñ–ª–µ—à
        else:  # straight_flush
            base += "üëë **–°–¢–†–ò–¢-–§–õ–ï–®** - –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –æ—Ä–µ—Ö!\n"
            base += "‚úÖ **–í–°–Å –í –ë–ê–ù–ö**: Impossible to beat –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏.\n\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –õ—é–±–∞—è –∞–≥—Ä–µ—Å—Å–∏—è –æ–ø—Ä–∞–≤–¥–∞–Ω–∞\n"
            base += "‚Ä¢ –ù–∞ —Ä–∏–≤–µ—Ä–µ: Overbet 2-3x pot —Ä–∞–∑–º–µ—Ä–∞\n"
            base += f"‚Ä¢ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: –ö—Ç–æ-—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–ª–∞—Ç–∏—Ç\n\n"
            
            return base + self._add_positional_advice(
                "Slow-play —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è trap'–∞",
                "–ê–≥—Ä–µ—Å—Å–∏—è —Å—Ä–∞–∑—É - –Ω–µ –¥–∞–≤–∞—Ç—å –¥–µ—à–µ–≤—ã—Ö –∫–∞—Ä—Ç"
            )
    
    # ===================== STRONG HANDS =====================
    
    def _recommend_strong(
        self,
        hand_type: str,
        win_rate: float,
        texture: Dict,
        num_opponents: int,
        stage: GameStage,
        texture_match: Dict,
        outs_breakdown: Dict
    ) -> str:
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–∏–ª—å–Ω—ã—Ö —Ä—É–∫ (—Ñ–ª–µ—à, —Å—Ç—Ä–∏—Ç)"""
        
        base = "üí™ **–°–ò–õ–¨–ù–ê–Ø –†–£–ö–ê**\n\n"
        
        # –§–ª–µ—à
        if hand_type == 'flush':
            base += "‚ô†Ô∏è **–§–ª–µ—à**\n"
            
            if texture_match['flush_compatible']:
                base += "‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –ú–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π –±–æ—Ä–¥ - –≤–æ–∑–º–æ–∂–µ–Ω —Å—Ç–∞—Ä—à–∏–π —Ñ–ª–µ—à —É –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞!\n"
                base += "‚Ä¢ –û—Ü–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ä—à–∏–Ω—Å—Ç–≤–æ –≤–∞—à–µ–≥–æ —Ñ–ª–µ—à–∞:\n"
                base += "  - –û—Ä–µ—Ö–æ–≤—ã–π/–≤—Ç–æ—Ä–æ–π —Ñ–ª–µ—à: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–≥—Ä–∞\n"
                base += "  - –ù–∏–∑–∫–∏–π —Ñ–ª–µ—à: –û—Å—Ç–æ—Ä–æ–∂–Ω–∞—è –∏–≥—Ä–∞, pot control\n\n"
            else:
                base += "‚úÖ –§–ª–µ—à –Ω–∞ 2-tone –±–æ—Ä–¥–µ - –æ–ø–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –æ–∂–∏–¥–∞—é—Ç!\n\n"
            
            if win_rate >= 75:
                base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç –æ—Ç–ª–∏—á–Ω—ã–π** - –∏–≥—Ä–∞–µ–º –Ω–∞ value!\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –§–ª–æ–ø/—Ç–µ—Ä–Ω: Bet –¥–ª—è –∑–∞—â–∏—Ç—ã –∏ value\n"
                base += "‚Ä¢ –†–∏–≤–µ—Ä: –ö—Ä—É–ø–Ω—ã–π value bet (60-75% pot)\n"
            elif win_rate >= 55:
                base += "‚ö†Ô∏è **–í–∏–Ω—Ä–µ–π—Ç —É–º–µ—Ä–µ–Ω–Ω—ã–π** - –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞—è –∏–≥—Ä–∞\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è value\n"
                base += "‚Ä¢ –ò–∑–±–µ–≥–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã—Ö –±–∞–Ω–∫–æ–≤\n"
            else:
                base += "‚ùå **–í–∏–Ω—Ä–µ–π—Ç –Ω–∏–∑–∫–∏–π** - pot control –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –ª–∏–Ω–∏—è\n"
                base += "‚Ä¢ Fold –∫ –∞–≥—Ä–µ—Å—Å–∏–∏, –µ—Å–ª–∏ –±–æ—Ä–¥ –ø–∞—Ä–Ω—ã–π (—Ñ—É–ª–ª-—Ö–∞—É—Å)\n"
            
            base += f"\n‚Ä¢ –ü—Ä–æ—Ç–∏–≤ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: "
            if num_opponents == 1:
                base += "–ú–æ–∂–Ω–æ –±–ª–µ—Ñ–∫—ç—Ç—á–∏—Ç—å\n"
            else:
                base += "–û—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ - –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å—Ç–∞—Ä—à–∏–π —Ñ–ª–µ—à\n"
            
            base += "\n" + self._add_opponent_behavior_advice(**{
                "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "–ß–µ–∫-–∫–æ–ª–ª –∏–ª–∏ —á–µ–∫-—Ä–µ–π–∑ –µ—Å–ª–∏ —Ñ–ª–µ—à —Å—Ç–∞—Ä—à–∏–π",
                "–ø–∞—Å—Å–∏–≤–µ–Ω": "Bet –¥–ª—è value - –≤–æ–∑—å–º—ë—Ç —Å –º–ª–∞–¥—à–∏–º–∏ —Ä—É–∫–∞–º–∏",
                "–Ω–∞ —Ç–∏–ª—å—Ç–µ": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è - –∑–∞–ø–ª–∞—Ç–∏—Ç —à–∏—Ä–æ–∫–æ"
            })
            
        # –°—Ç—Ä–∏—Ç
        else:  # straight
            base += "üìä **–°—Ç—Ä–∏—Ç**\n"
            
            if texture_match['straight_compatible']:
                base += "‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ä–¥ - –≤–∞—à —Å—Ç—Ä–∏—Ç –≤–∏–¥–µ–Ω!\n"
                base += "‚Ä¢ –û–ø–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ç–æ—Ç –∂–µ —Å—Ç—Ä–∏—Ç (—Å–ø–ª–∏—Ç) –∏–ª–∏ —Å—Ç–∞—Ä—à–∏–π —Å—Ç—Ä–∏—Ç\n"
                base += "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ä–µ—Ö–æ–≤—ã–π –ª–∏ –≤–∞—à —Å—Ç—Ä–∏—Ç\n\n"
            
            if texture.get('monotone') or texture.get('flush_draw'):
                base += "‚ö†Ô∏è **–û–ü–ê–°–ù–û–°–¢–¨ –§–õ–ï–®–ê** –Ω–∞ –±–æ—Ä–¥–µ!\n"
                base += "‚Ä¢ –ò–≥—Ä–∞–π—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ –µ—Å–ª–∏ –±–æ—Ä–¥ 3-flush\n"
                base += "‚Ä¢ –ù–∞ —Ä–∏–≤–µ—Ä–µ –∫ —Ñ–ª–µ—à—É - —Ç–æ–ª—å–∫–æ —á–µ–∫-–∫–æ–ª–ª –º–∞–ª—ã—Ö —Å—Ç–∞–≤–æ–∫\n\n"
            
            if win_rate >= 70:
                base += "‚úÖ **–°–∏–ª—å–Ω—ã–π —Å—Ç—Ä–∏—Ç** - –∏–≥—Ä–∞–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ Bet –¥–ª—è value –∏ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—Ä–æ\n"
                base += "‚Ä¢ –ù–µ –¥–∞–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫–∞—Ä—Ç –∫ —Ñ–ª–µ—à—É\n"
            else:
                base += "‚ö†Ô∏è **–£—è–∑–≤–∏–º—ã–π —Å—Ç—Ä–∏—Ç** - pot control\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏\n"
                base += "‚Ä¢ Fold –∫ –∞–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ —Ñ–ª–µ—à–µ–≤–æ–º/–ø–∞—Ä–Ω–æ–º —Ä–∏–≤–µ—Ä–µ\n"
            
            base += f"\n‚Ä¢ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: "
            if num_opponents >= 3:
                base += "Multiway - –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ñ–ª–µ—à/—Ñ—É–ª–ª-—Ö–∞—É—Å\n"
            
            base += "\n" + self._add_positional_advice(
                "–ú–æ–∂–Ω–æ —á–µ–∫-—Ä–µ–π–∑ –Ω–∞ —Ç–µ—Ä–Ω–µ –¥–ª—è –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏",
                "Bet —Å—Ä–∞–∑—É - –Ω–µ –¥–∞–≤–∞—Ç—å –¥–µ—à–µ–≤—ã—Ö –∫–∞—Ä—Ç –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞–º"
            )
        
        return base
    
    # ===================== MEDIUM HANDS =====================
    
    def _recommend_medium(
        self,
        hand_type: str,
        win_rate: float,
        texture: Dict,
        num_opponents: int,
        stage: GameStage,
        texture_match: Dict,
        total_outs: int
    ) -> str:
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Ä—É–∫"""
        
        base = "üéØ **–°–†–ï–î–ù–Ø–Ø –†–£–ö–ê**\n\n"
        
        # –°–µ—Ç/—Ç—Ä–∏–ø—Å
        if hand_type == 'three_kind':
            base += "üé≤ **–°–µ—Ç/–¢—Ä–∏–ø—Å**\n"
            
            if texture_match['set_compatible']:
                base += "‚úÖ –°–∫—Ä—ã—Ç—ã–π —Å–µ—Ç –Ω–∞ –Ω–µ–ø–∞—Ä–Ω–æ–º –±–æ—Ä–¥–µ - —Å–∏–ª—å–Ω–∞—è —Ä—É–∫–∞!\n\n"
            else:
                base += "‚ö†Ô∏è –¢—Ä–∏–ø—Å –Ω–∞ –ø–∞—Ä–Ω–æ–º –±–æ—Ä–¥–µ - –æ–ø–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ñ—É–ª–ª-—Ö–∞—É—Å\n\n"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –±–æ—Ä–¥–µ
            dangers = []
            if texture.get('monotone'):
                dangers.append("–º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π –±–æ—Ä–¥ (—Ñ–ª–µ—à)")
            if texture.get('coordinated'):
                dangers.append("–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ä–¥ (—Å—Ç—Ä–∏—Ç)")
            
            if dangers:
                base += f"‚ö†Ô∏è **–û–ü–ê–°–ù–û–°–¢–ò**: {', '.join(dangers)}\n"
                base += "‚Ä¢ –°–µ—Ç —É—è–∑–≤–∏–º –∫ —Å—Ç–∞—Ä—à–∏–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º\n"
                base += "‚Ä¢ –ò–≥—Ä–∞–π—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ –Ω–∞ –æ–ø–∞—Å–Ω—ã—Ö –±–æ—Ä–¥–∞—Ö\n\n"
            
            # –ê—É—Ç—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
            if total_outs >= 7:  # –∞—É—Ç—ã –Ω–∞ —Ñ—É–ª–ª-—Ö–∞—É—Å
                base += f"üéØ –£ –≤–∞—Å {total_outs} –∞—É—Ç–æ–≤ –Ω–∞ —Ñ—É–ª–ª-—Ö–∞—É—Å!\n"
                base += "‚Ä¢ –ú–æ–∂–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ –∏–≥—Ä–∞—Ç—å –¥–∞–∂–µ –ø—Ä–æ—Ç–∏–≤ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Ñ–ª–µ—à–∞\n\n"
            
            if win_rate >= 60:
                base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç —Ö–æ—Ä–æ—à–∏–π** - –∏–≥—Ä–∞–µ–º –Ω–∞ value\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –§–ª–æ–ø: Bet –¥–ª—è –∑–∞—â–∏—Ç—ã –∏ value (50-60% pot)\n"
                base += "‚Ä¢ –¢–µ—Ä–Ω: –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º bet\n"
                base += "‚Ä¢ –†–∏–≤–µ—Ä: Value bet –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–ª–µ—à–∞ –Ω–∞ –±–æ—Ä–¥–µ\n"
            elif win_rate >= 45:
                base += "‚ö†Ô∏è **–í–∏–Ω—Ä–µ–π—Ç —Å—Ä–µ–¥–Ω–∏–π** - –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞—è –∏–≥—Ä–∞\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –ú–∞–ª—ã–µ/—Å—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏\n"
                base += "‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –∫ –∞–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ –æ–ø–∞—Å–Ω—ã—Ö –±–æ—Ä–¥–∞—Ö\n"
            else:
                base += "‚ùå **–í–∏–Ω—Ä–µ–π—Ç –Ω–∏–∑–∫–∏–π** - —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —É–∂–µ –ø–æ–∑–∞–¥–∏\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –ß–µ–∫-fold –∏–ª–∏ fold –∫ –∫—Ä—É–ø–Ω—ã–º —Å—Ç–∞–≤–∫–∞–º\n"
                base += "‚Ä¢ –¢–æ–ª—å–∫–æ cheap showdown\n"
            
            base += f"\n‚Ä¢ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: "
            if num_opponents >= 3:
                base += "Multiway - –≤—ã—Å–æ–∫ —Ä–∏—Å–∫ —Ñ–ª–µ—à–∞/—Å—Ç—Ä–∏—Ç–∞ —É –∫–æ–≥–æ-—Ç–æ\n"
            else:
                base += "Heads-up - –º–æ–∂–µ—Ç–µ –∏–≥—Ä–∞—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ\n"
        
        # –î–≤–µ –ø–∞—Ä—ã
        else:  # two_pair
            base += "üé¥ **–î–≤–µ –ø–∞—Ä—ã**\n"
            
            if texture.get('paired'):
                base += "‚ö†Ô∏è –ü–∞—Ä–Ω—ã–π –±–æ—Ä–¥ - –≤–æ–∑–º–æ–∂–Ω—ã —Å—Ç–∞—Ä—à–∏–µ –¥–≤–µ –ø–∞—Ä—ã/—Ç—Ä–∏–ø—Å/—Ñ—É–ª–ª-—Ö–∞—É—Å\n\n"
            else:
                base += "‚úÖ –•–æ—Ä–æ—à–∞—è —Ä—É–∫–∞ –Ω–∞ –Ω–µ–ø–∞—Ä–Ω–æ–º –±–æ—Ä–¥–µ\n\n"
            
            # –û–ø–∞—Å–Ω–æ—Å—Ç–∏
            dangers = []
            if texture.get('monotone'):
                dangers.append("—Ñ–ª–µ—à")
            if texture.get('coordinated'):
                dangers.append("—Å—Ç—Ä–∏—Ç")
            if texture.get('paired'):
                dangers.append("—Ñ—É–ª–ª-—Ö–∞—É—Å/—Ç—Ä–∏–ø—Å")
            
            if dangers:
                base += f"‚ö†Ô∏è **–í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: {', '.join(dangers)}\n\n"
            
            # –ê—É—Ç—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
            if total_outs >= 4:
                base += f"üéØ {total_outs} –∞—É—Ç–æ–≤ –Ω–∞ —Ñ—É–ª–ª-—Ö–∞—É—Å!\n"
                base += "‚Ä¢ –ü—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–∏ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞ - –µ—Å—Ç—å —à–∞–Ω—Å –ø–µ—Ä–µ–µ—Ö–∞—Ç—å\n\n"
            
            if win_rate >= 65:
                base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç –æ—Ç–ª–∏—á–Ω—ã–π** - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–≥—Ä–∞\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ Bet –¥–ª—è value –Ω–∞ –≤—Å–µ—Ö —É–ª–∏—Ü–∞—Ö\n"
                base += "‚Ä¢ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—Ä–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞\n"
            elif win_rate >= 50:
                base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç —Ö–æ—Ä–æ—à–∏–π** - –∏–≥—Ä–∞–µ–º –Ω–∞ value\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –°—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è value\n"
                base += "‚Ä¢ –û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ –æ–ø–∞—Å–Ω—ã—Ö —Ä–∏–≤–∞—Ö\n"
            else:
                base += "‚ö†Ô∏è **–í–∏–Ω—Ä–µ–π—Ç –Ω–∏–∑–∫–∏–π** - pot control\n"
                base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
                base += "‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –º–∞–ª—ã—Ö —Å—Ç–∞–≤–æ–∫\n"
                base += "‚Ä¢ Fold –∫ –∞–≥—Ä–µ—Å—Å–∏–∏ –Ω–∞ —Ñ–ª–µ—à–µ–≤—ã—Ö/—Å—Ç—Ä–∏—Ç–æ–≤—ã—Ö –±–æ—Ä–∞—Ö\n"
            
            if stage == GameStage.RIVER:
                base += "\nüìå **–ù–∞ —Ä–∏–≤–µ—Ä–µ:**\n"
                if texture.get('monotone') or texture.get('coordinated'):
                    base += "‚Ä¢ –û–ø–∞—Å–Ω—ã–π –±–æ—Ä–¥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è - —Ç–æ–ª—å–∫–æ —á–µ–∫-–∫–æ–ª–ª –º–∞–ª—ã—Ö —Å—Ç–∞–≤–æ–∫\n"
                else:
                    base += "‚Ä¢ –°—É—Ö–æ–π –±–æ—Ä–¥ - value bet 50-60% pot\n"
        
        base += "\n" + self._add_opponent_behavior_advice(**{
            "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "–ß–µ–∫-–∫–æ–ª–ª –∏–ª–∏ —á–µ–∫-—Ä–µ–π–∑ –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã –≤ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ",
            "–ø–∞—Å—Å–∏–≤–µ–Ω": "Value bet - –≤–æ–∑—å–º—ë—Ç —Å –º–ª–∞–¥—à–∏–º–∏ –ø–∞—Ä–∞–º–∏",
            "—Ç–∞–π—Ç–æ–≤": "–ú–∞–ª—ã–µ —Å—Ç–∞–≤–∫–∏ - –ø–ª–∞—Ç–∏—Ç —Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ä—É–∫–∞–º–∏"
        })
        
        return base
    
    # ===================== WEAK MADE HANDS =====================
    
    def _recommend_weak_made(
        self,
        hand_type: str,
        win_rate: float,
        texture: Dict,
        num_opponents: int,
        stage: GameStage,
        total_outs: int,
        outs_breakdown: Dict
    ) -> str:
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–∞–±—ã—Ö –≥–æ—Ç–æ–≤—ã—Ö —Ä—É–∫ (–æ–¥–Ω–∞ –ø–∞—Ä–∞)"""
        
        base = "‚ö†Ô∏è **–°–õ–ê–ë–ê–Ø –ì–û–¢–û–í–ê–Ø –†–£–ö–ê**\n\n"
        base += "üÉè **–û–¥–Ω–∞ –ø–∞—Ä–∞**\n"
        
        # –û—Ü–µ–Ω–∫–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–æ—Ä–¥–∞
        danger_level = 0
        dangers = []
        
        if texture.get('monotone'):
            danger_level += 3
            dangers.append("–º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π –±–æ—Ä–¥ (—Ñ–ª–µ—à)")
        elif texture.get('flush_draw'):
            danger_level += 2
            dangers.append("—Ñ–ª–µ—à-–¥—Ä–æ –Ω–∞ –±–æ—Ä–¥–µ")
        
        if texture.get('coordinated'):
            danger_level += 2
            dangers.append("–∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ä–¥ (—Å—Ç—Ä–∏—Ç—ã)")
        
        if texture.get('paired'):
            danger_level += 2
            dangers.append("–ø–∞—Ä–Ω—ã–π –±–æ—Ä–¥ (—Ç—Ä–∏–ø—Å—ã)")
        
        if dangers:
            base += f"‚ö†Ô∏è **–û–ü–ê–°–ù–û–°–¢–ò** ({danger_level}/10): {', '.join(dangers)}\n\n"
        else:
            base += "‚úÖ –°—É—Ö–æ–π –±–æ—Ä–¥ - –≤–∞—à–∞ –ø–∞—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—É—á—à–µ–π\n\n"
        
        # –ê—É—Ç—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
        if total_outs >= 5:
            base += f"üéØ {total_outs} –∞—É—Ç–æ–≤ –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ:\n"
            if outs_breakdown.get('set_trips', 0) >= 2:
                base += f"  ‚Ä¢ {outs_breakdown['set_trips']} –∞—É—Ç–æ–≤ –Ω–∞ —Å–µ—Ç\n"
            if outs_breakdown.get('two_pair', 0) >= 3:
                base += f"  ‚Ä¢ –ê—É—Ç—ã –Ω–∞ –¥–≤–µ –ø–∞—Ä—ã\n"
            base += "‚Ä¢ –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏ —Ö–æ—Ä–æ—à–∏—Ö pot odds\n\n"
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–∏–Ω—Ä–µ–π—Ç—É
        if win_rate >= 70:
            base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç –≤—ã—Å–æ–∫–∏–π** (likely top pair) - –∏–≥—Ä–∞–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ!\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ Bet –¥–ª—è value –∏ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—Ä–æ\n"
            base += "‚Ä¢ –ù–∞ —Ç–µ—Ä–Ω–µ/—Ä–∏–≤–µ—Ä–µ: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º bet –µ—Å–ª–∏ –Ω–µ—Ç —Ñ–ª–µ—à–∞/—Å—Ç—Ä–∏—Ç–∞\n"
            
        elif win_rate >= 55:
            base += "‚úÖ **–í–∏–Ω—Ä–µ–π—Ç —Ö–æ—Ä–æ—à–∏–π** - –∏–≥—Ä–∞–µ–º –Ω–∞ value –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ú–∞–ª—ã–µ/—Å—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è value\n"
            base += "‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –∫ –º–∞–ª–æ–π –∞–≥—Ä–µ—Å—Å–∏–∏\n"
            base += "‚Ä¢ Fold –∫ –∫—Ä—É–ø–Ω—ã–º —Å—Ç–∞–≤–∫–∞–º –Ω–∞ –æ–ø–∞—Å–Ω—ã—Ö –±–æ—Ä–¥–∞—Ö\n"
            
        elif win_rate >= 40:
            base += "‚ö†Ô∏è **–í–∏–Ω—Ä–µ–π—Ç —Å—Ä–µ–¥–Ω–∏–π** - pot control\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –º–∞–ª—ã—Ö —Å—Ç–∞–≤–æ–∫\n"
            base += "‚Ä¢ Fold –∫ –∞–≥—Ä–µ—Å—Å–∏–∏\n"
            base += "‚Ä¢ Cheap showdown –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ\n"
            
        else:
            base += "‚ùå **–í–∏–Ω—Ä–µ–π—Ç –Ω–∏–∑–∫–∏–π** - –≤–µ—Ä–æ—è—Ç–Ω–æ —É–∂–µ –ø–æ–∑–∞–¥–∏\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ß–µ–∫-fold\n"
            base += "‚Ä¢ Fold –∫ –ª—é–±—ã–º —Å—Ç–∞–≤–∫–∞–º\n"
            base += "‚Ä¢ Bluff-catcher —Ç–æ–ª—å–∫–æ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö\n"
        
        # –ú—É–ª—å—Ç–∏–≤–µ–π vs heads-up
        base += f"\n‚Ä¢ **{num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤**: "
        if num_opponents >= 4:
            base += "Multiway - –æ–¥–Ω–∞ –ø–∞—Ä–∞ –æ—á–µ–Ω—å —Å–ª–∞–±–∞, –∏–≥—Ä–∞–π—Ç–µ –∫—Ä–∞–π–Ω–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ\n"
        elif num_opponents >= 2:
            base += "3-way - –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞—è –∏–≥—Ä–∞, –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ª—É—á—à–µ\n"
        else:
            base += "Heads-up - –º–æ–∂–µ—Ç–µ –±–ª–µ—Ñ–∫—ç—Ç—á–∏—Ç—å —Å —Ö–æ—Ä–æ—à–µ–π –ø–∞—Ä–æ–π\n"
        
        # –°—Ç–∞–¥–∏—è –∏–≥—Ä—ã
        if stage == GameStage.FLOP:
            base += "\nüìå **–ù–∞ —Ñ–ª–æ–ø–µ**: –û—Ü–µ–Ω–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏\n"
        elif stage == GameStage.TURN:
            base += "\nüìå **–ù–∞ —Ç–µ—Ä–Ω–µ**: –ü–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–π—Ç–µ —Å –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π\n"
        elif stage == GameStage.RIVER:
            base += "\nüìå **–ù–∞ —Ä–∏–≤–µ—Ä–µ**: "
            if danger_level >= 5:
                base += "–û–ø–∞—Å–Ω—ã–π –±–æ—Ä–¥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è - bluff-catcher —Ç–æ–ª—å–∫–æ —Å —Ç–æ–ø-–ø–∞—Ä–æ–π\n"
            else:
                base += "–°—É—Ö–æ–π –±–æ—Ä–¥ - –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å value —Å —Ö–æ—Ä–æ—à–µ–π –ø–∞—Ä–æ–π\n"
        
        base += "\n" + self._add_positional_advice(
            "–ú–æ–∂–µ—Ç–µ –±–ª–µ—Ñ–∫—ç—Ç—á–∏—Ç—å —Å —Ö–æ—Ä–æ—à–µ–π –ø–∞—Ä–æ–π –Ω–∞ —Å—É—Ö–∏—Ö –±–æ—Ä–¥–∞—Ö",
            "–ë–µ–∑ –ø–æ–∑–∏—Ü–∏–∏ - –∏–≥—Ä–∞–π—Ç–µ fit-or-fold (—á–µ–∫-fold –µ—Å–ª–∏ –Ω–µ —É–ª—É—á—à–∏–ª–∏—Å—å)"
        )
        
        base += "\n" + self._add_opponent_behavior_advice(**{
            "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "Bluff-catch —Å —Ç–æ–ø-–ø–∞—Ä–æ–π, fold —Å –º–ª–∞–¥—à–∏–º–∏",
            "–ø–∞—Å—Å–∏–≤–µ–Ω": "–ú–∞–ª—ã–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è value - —á–∞—Å—Ç–æ –ø–ª–∞—Ç–∏—Ç —Å —Ö—É–∂–µ",
            "—Ç–∞–π—Ç–æ–≤": "–ß–µ–∫-fold - —Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ —Å —Å–∏–ª—å–Ω—ã–º–∏ —Ä—É–∫–∞–º–∏"
        })
        
        return base
    
    # ===================== DRAWS =====================
    
    def _recommend_draw(
        self,
        total_outs: int,
        outs_breakdown: Dict,
        win_rate: float,
        texture: Dict,
        num_opponents: int,
        stage: GameStage
    ) -> str:
        """–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥—Ä–æ"""
        
        base = "üé≤ **–î–†–û / –ù–ï–¢ –ì–û–¢–û–í–û–ô –ö–û–ú–ë–ò–ù–ê–¶–ò–ò**\n\n"
        
        # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥—Ä–æ
        flush_outs = outs_breakdown.get('flush', 0)
        straight_outs = outs_breakdown.get('straight', 0)
        set_outs = outs_breakdown.get('set_trips', 0)
        overcard_outs = outs_breakdown.get('overcard', 0)
        
        # –û–ø–∏—Å–∞–Ω–∏–µ –¥—Ä–æ
        draw_types = []
        if flush_outs >= 9:
            draw_types.append(f"—Ñ–ª–µ—à-–¥—Ä–æ ({flush_outs} –∞—É—Ç–æ–≤)")
        if straight_outs >= 8:
            draw_types.append(f"—Å—Ç—Ä–∏—Ç-–¥—Ä–æ ({straight_outs} –∞—É—Ç–æ–≤)")
        if straight_outs >= 4 and straight_outs < 8:
            draw_types.append(f"–≥–∞—Ç—à–æ—Ç ({straight_outs} –∞—É—Ç–æ–≤)")
        if set_outs >= 2:
            draw_types.append(f"–ø–∞—Ä–∞ —Å –∞—É—Ç–∞–º–∏ –Ω–∞ —Å–µ—Ç ({set_outs} –∞—É—Ç–æ–≤)")
        if overcard_outs >= 3:
            draw_types.append(f"–æ–≤–µ—Ä–∫–∞—Ä—Ç—ã ({overcard_outs} –∞—É—Ç–æ–≤)")
        
        if draw_types:
            base += f"**–£ –≤–∞—Å**: {', '.join(draw_types)}\n"
            base += f"**–í—Å–µ–≥–æ –∞—É—Ç–æ–≤**: {total_outs}\n\n"
        else:
            base += "‚ùå **–ó–Ω–∞—á–∏–º—ã—Ö –¥—Ä–æ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ**\n\n"
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞—É—Ç–æ–≤
        if total_outs >= 15:
            base += "üöÄ **–ú–û–ù–°–¢–†-–î–†–û** (15+ –∞—É—Ç–æ–≤) - —Ñ–∞–≤–æ—Ä–∏—Ç –¥–∞–∂–µ –ø—Ä–æ—Ç–∏–≤ –≥–æ—Ç–æ–≤—ã—Ö —Ä—É–∫!\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ò–≥—Ä–∞–π—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ\n"
            base += "‚Ä¢ –†–µ–π–∑/3-–±–µ—Ç –¥–ª—è semi-bluff\n"
            base += "‚Ä¢ –ú–æ–∂–µ—Ç–µ –∫–æ–ª–ª–∏—Ä–æ–≤–∞—Ç—å all-in –Ω–∞ —Ñ–ª–æ–ø–µ/—Ç–µ—Ä–Ω–µ\n"
            base += "‚Ä¢ –í –ø–æ–∑–∏—Ü–∏–∏: —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —á–µ–∫-—Ä–µ–π–∑\n\n"
            
            base += self._add_positional_advice(
                "–ß–µ–∫-—Ä–µ–π–∑ –Ω–∞ —Ñ–ª–æ–ø–µ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π fold equity",
                "–†–µ–π–∑ —Å—Ä–∞–∑—É - –Ω–µ –¥–∞–≤–∞–π—Ç–µ –¥–µ—à–µ–≤–æ —É–≤–∏–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç—É"
            )
        
        elif total_outs >= 12:
            base += "‚ö° **–°–ò–õ–¨–ù–û–ï –î–†–û** (12-14 –∞—É—Ç–æ–≤) - –æ—Ç–ª–∏—á–Ω—ã–µ —à–∞–Ω—Å—ã!\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–≥—Ä–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–∞\n"
            base += "‚Ä¢ Bet/raise –¥–ª—è semi-bluff\n"
            base += "‚Ä¢ –ö–æ–ª–ª–∏—Ä—É–π—Ç–µ —Å—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏\n"
            base += f"‚Ä¢ –ü—Ä–æ—Ç–∏–≤ {num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤: –∫—Ç–æ-—Ç–æ –º–æ–∂–µ—Ç —Å—Ñ–æ–ª–¥–∏—Ç—å –ª—É—á—à—É—é —Ä—É–∫—É\n\n"
            
            if stage == GameStage.FLOP:
                cards_remaining = 2
                base += f"üìä **–ù–∞ —Ñ–ª–æ–ø–µ**: ~{min(total_outs * 4, 100):.0f}% —É–ª—É—á—à–∏—Ç—å—Å—è –¥–æ —Ä–∏–≤–µ—Ä–∞\n"
            else:
                cards_remaining = 1
                base += f"üìä **–ù–∞ —Ç–µ—Ä–Ω–µ**: ~{min(total_outs * 2, 100):.0f}% —É–ª—É—á—à–∏—Ç—å—Å—è –Ω–∞ —Ä–∏–≤–µ—Ä–µ\n"
        
        elif total_outs >= 9:
            base += "‚úÖ **–•–û–†–û–®–ï–ï –î–†–û** (9-11 –∞—É—Ç–æ–≤)\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ö–æ–ª–ª–∏—Ä—É–π—Ç–µ –º–∞–ª—ã–µ/—Å—Ä–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏\n"
            base += "‚Ä¢ Semi-bluff bet –≤ –ø–æ–∑–∏—Ü–∏–∏\n"
            base += "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ pot odds –ø–µ—Ä–µ–¥ –∫–æ–ª–ª–æ–º:\n"
            
            if stage == GameStage.FLOP:
                base += f"  - ~{min(total_outs * 4, 100):.0f}% —É–ª—É—á—à–∏—Ç—å—Å—è –¥–æ —Ä–∏–≤–µ—Ä–∞\n"
                base += "  - –ù—É–∂–Ω—ã pot odds ~2.5:1 –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω–æ–≥–æ –∫–æ–ª–ª–∞\n"
            else:
                base += f"  - ~{min(total_outs * 2, 100):.0f}% —É–ª—É—á—à–∏—Ç—å—Å—è –Ω–∞ —Ä–∏–≤–µ—Ä–µ\n"
                base += "  - –ù—É–∂–Ω—ã pot odds ~4:1 –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω–æ–≥–æ –∫–æ–ª–ª–∞\n"
            
            base += "\n" + self._add_opponent_behavior_advice(**{
                "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "–ú–æ–∂–µ—Ç–µ semi-bluff —Ä–µ–π–∑ –µ—Å–ª–∏ fold equity –≤—ã—Å–æ–∫–∞—è",
                "–ø–∞—Å—Å–∏–≤–µ–Ω": "–ú–æ–∂–µ—Ç–µ –∫—Ä–∞—Å—Ç—å –±–∞–Ω–∫ —Å—Ç–∞–≤–∫–æ–π –Ω–∞ —Ç–µ—Ä–Ω–µ",
                "—Ç–∞–π—Ç–æ–≤": "–ö–æ–ª–ª–∏—Ä—É–π—Ç–µ –∏ —É–ª—É—á—à–∞–π—Ç–µ—Å—å - –æ–Ω–∏ –ø–ª–∞—Ç—è—Ç —Å –≥–æ—Ç–æ–≤—ã–º–∏ —Ä—É–∫–∞–º–∏"
            })
        
        elif total_outs >= 6:
            base += "‚ö†Ô∏è **–°–†–ï–î–ù–ï–ï –î–†–û** (6-8 –∞—É—Ç–æ–≤)\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ö–æ–ª–ª–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û –º–∞–ª—ã–µ —Å—Ç–∞–≤–∫–∏\n"
            base += "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ pot odds –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ\n"
            base += "‚Ä¢ Fold –∫ —Å—Ä–µ–¥–Ω–∏–º/–∫—Ä—É–ø–Ω—ã–º —Å—Ç–∞–≤–∫–∞–º\n"
            
            if stage == GameStage.FLOP:
                base += f"‚Ä¢ ~{min(total_outs * 4, 100):.0f}% —à–∞–Ω—Å —É–ª—É—á—à–∏—Ç—å—Å—è –¥–æ —Ä–∏–≤–µ—Ä–∞\n"
            else:
                base += f"‚Ä¢ ~{min(total_outs * 2, 100):.0f}% —à–∞–Ω—Å –Ω–∞ —Ä–∏–≤–µ—Ä–µ\n"
                base += "‚Ä¢ –ù–∞ —Ç–µ—Ä–Ω–µ —Å 6-8 –∞—É—Ç–∞–º–∏ - –Ω—É–∂–Ω—ã pot odds –º–∏–Ω–∏–º—É–º 5:1\n"
            
            base += "\nüìå **–í–∞–∂–Ω–æ**: –ù–µ –ø–µ—Ä–µ–æ—Ü–µ–Ω–∏–≤–∞–π—Ç–µ —Å–ª–∞–±—ã–µ –¥—Ä–æ!\n"
        
        elif total_outs >= 4:
            base += "ü§è **–°–õ–ê–ë–û–ï –î–†–û** (4-5 –∞—É—Ç–æ–≤)\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ –ö–æ–ª–ª–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏\n"
            base += "‚Ä¢ Fold –∫ –ª—é–±–æ–π —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–≥—Ä–µ—Å—Å–∏–∏\n"
            base += "‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ fold –¥–∞–∂–µ –∫ –º–∞–ª—ã–º —Å—Ç–∞–≤–∫–∞–º –±–µ–∑ implied odds\n"
            
            if stage == GameStage.FLOP:
                base += f"‚Ä¢ –¢–æ–ª—å–∫–æ ~{min(total_outs * 4, 100):.0f}% —É–ª—É—á—à–∏—Ç—å—Å—è –¥–æ —Ä–∏–≤–µ—Ä–∞\n"
            else:
                base += f"‚Ä¢ –¢–æ–ª—å–∫–æ ~{min(total_outs * 2, 100):.0f}% –ø–æ–ø–∞—Å—Ç—å –Ω–∞ —Ä–∏–≤–µ—Ä–µ\n"
                base += "‚Ä¢ **–ù–∞ —Ç–µ—Ä–Ω–µ —Å–æ —Å–ª–∞–±—ã–º –¥—Ä–æ - —á–∞—â–µ –≤—Å–µ–≥–æ fold**\n"
        
        elif total_outs >= 1:
            base += "üòî **–û–ß–ï–ù–¨ –°–õ–ê–ë–û–ï –î–†–û** (1-3 –∞—É—Ç–∞)\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ Fold –∫ –ª—é–±—ã–º —Å—Ç–∞–≤–∫–∞–º\n"
            base += "‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç\n"
            base += "‚Ä¢ –ù–µ –∏–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ —Ç–∞–∫–∏–µ –¥—Ä–æ\n"
        
        else:
            base += "‚ùå **–ù–ï–¢ –ê–£–¢–û–í / –í–û–ó–î–£–•**\n"
            base += "**–î–µ–π—Å—Ç–≤–∏—è:**\n"
            base += "‚Ä¢ Fold –∫ –ª—é–±–æ–π —Å—Ç–∞–≤–∫–µ\n"
            base += "‚Ä¢ –ß–∏—Å—Ç—ã–π –±–ª–µ—Ñ - —Ç–æ–ª—å–∫–æ –≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö\n"
            base += "‚Ä¢ –ù–µ –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –±–µ–∑ fold equity\n\n"
            
            base += self._add_positional_advice(
                "–í –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å steal —Å—Ç–∞–≤–∫—É –Ω–∞ —Å—Ç—Ä–∞—à–Ω–æ–π –∫–∞—Ä—Ç–µ",
                "–ë–µ–∑ –ø–æ–∑–∏—Ü–∏–∏ - —á–µ–∫-fold, –±–ª–µ—Ñ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
            )
            
            base += "\n" + self._add_opponent_behavior_advice(**{
                "–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω": "Fold –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ",
                "–ø–∞—Å—Å–∏–≤–µ–Ω": "–ú–æ–∂–µ—Ç–µ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–∫—Ä–∞—Å—Ç—å –Ω–∞ —Ç–µ—Ä–Ω–µ/—Ä–∏–≤–µ—Ä–µ",
                "–ø–æ–∫–∞–∑–∞–ª —Å–ª–∞–±–æ—Å—Ç—å": "–ë–ª–µ—Ñ —Å—Ç–∞–≤–∫–∞ –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å"
            })
            
            return base
        
        # –ê–Ω–∞–ª–∏–∑ –≤–∏–Ω—Ä–µ–π—Ç–∞ –¥–ª—è –¥—Ä–æ
        if win_rate >= 45:
            base += f"\n‚úÖ **–í–∏–Ω—Ä–µ–π—Ç {win_rate:.1f}%** - –¥—Ä–æ –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à–∏–µ —à–∞–Ω—Å—ã!\n"
        elif win_rate >= 30:
            base += f"\n‚ö†Ô∏è **–í–∏–Ω—Ä–µ–π—Ç {win_rate:.1f}%** - –¥—Ä–æ –º–∞—Ä–≥–∏–Ω–∞–ª—å–Ω–æ–µ\n"
        else:
            base += f"\n‚ùå **–í–∏–Ω—Ä–µ–π—Ç {win_rate:.1f}%** - –¥—Ä–æ —Å–ª–∞–±–æ–µ, –Ω—É–∂–Ω—ã –æ—Ç–ª–∏—á–Ω—ã–µ pot odds\n"
        
        # Multiway considerations
        if num_opponents >= 3:
            base += f"\n‚ö†Ô∏è **{num_opponents} –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤** (multiway):\n"
            base += "‚Ä¢ Implied odds –ª—É—á—à–µ (–±–æ–ª—å—à–µ –¥–µ–Ω–µ–≥ –≤ –±–∞–Ω–∫–µ –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏)\n"
            base += "‚Ä¢ Fold equity —Ö—É–∂–µ (—Å–ª–æ–∂–Ω–µ–µ –≤—ã–±–∏—Ç—å –≤—Å–µ—Ö –±–ª–µ—Ñ–æ–º)\n"
            base += "‚Ä¢ –ò–≥—Ä–∞–π—Ç–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ–µ - –∫—Ç–æ-—Ç–æ —É–∂–µ –∏–º–µ–µ—Ç –≥–æ—Ç–æ–≤—É—é —Ä—É–∫—É\n"
        
        # –°—Ç–∞–¥–∏—è –∏–≥—Ä—ã
        if stage == GameStage.TURN:
            base += "\n‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï - –í–´ –ù–ê –¢–ï–†–ù–ï**:\n"
            base += "‚Ä¢ –¢–æ–ª—å–∫–æ 1 –∫–∞—Ä—Ç–∞ –æ—Å—Ç–∞–ª–∞—Å—å (—Ä–∏–≤–µ—Ä)\n"
            base += "‚Ä¢ Implied odds —É—Ö—É–¥—à–∏–ª–∏—Å—å\n"
            base += "‚Ä¢ –ë—É–¥—å—Ç–µ —Å—Ç—Ä–æ–∂–µ –∫ pot odds\n"
        
        base += "\n" + self._add_positional_advice(
            "–í –ø–æ–∑–∏—Ü–∏–∏ —Å –¥—Ä–æ:\n  ‚Ä¢ –ú–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–Ω–∫–∞\n  ‚Ä¢ –ß–µ–∫-–±—ç–∫ –Ω–∞ —Ç–µ—Ä–Ω–µ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã\n  ‚Ä¢ –ë–ª–µ—Ñ –Ω–∞ —Ä–∏–≤–µ—Ä–µ –µ—Å–ª–∏ –¥—Ä–æ –ø—Ä–æ–º–∞—Ö–Ω—É–ª–æ—Å—å –Ω–æ –ø—Ä–∏—à–ª–∞ —Å—Ç—Ä–∞—à–Ω–∞—è –∫–∞—Ä—Ç–∞",
            "–ë–µ–∑ –ø–æ–∑–∏—Ü–∏–∏ —Å –¥—Ä–æ:\n  ‚Ä¢ –ß–µ–∫-–∫–æ–ª–ª –ª–∏–Ω–∏—è –æ–±—ã—á–Ω–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞\n  ‚Ä¢ –î–æ–Ω–∫-–±–µ—Ç —Ç–æ–ª—å–∫–æ —Å –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–º –¥—Ä–æ (12+ –∞—É—Ç–æ–≤)\n  ‚Ä¢ –ì–æ—Ç–æ–≤—å—Ç–µ—Å—å —Ñ–æ–ª–¥–∏—Ç—å –Ω–∞ —Ç–µ—Ä–Ω–µ/—Ä–∏–≤–µ—Ä–µ –∫ –∞–≥—Ä–µ—Å—Å–∏–∏"
        )
        
        return base
    
    # ===================== HELPER METHODS =====================
    
    def _add_positional_advice(self, in_position: str, out_of_position: str) -> str:
        """–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã"""
        return (
            "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n"
            "‚îÇ üìç –ü–û–ó–ò–¶–ò–û–ù–ù–´–ï –°–û–í–ï–¢–´ (–¥–ª—è –≤–∞—Å):   ‚îÇ\n"
            "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n"
            f"üü¢ **–ï—Å–ª–∏ –≤—ã –í –ü–û–ó–ò–¶–ò–ò** (BTN/CO):\n   {in_position}\n\n"
            f"üî¥ **–ï—Å–ª–∏ –≤—ã –ë–ï–ó –ü–û–ó–ò–¶–ò–ò** (UTG/MP/SB/BB):\n   {out_of_position}\n"
        )
    
    def _add_opponent_behavior_advice(self, **behaviors) -> str:
        """–î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–≤–µ—Ç—ã –ø–æ –ø–æ–≤–µ–¥–µ–Ω–∏—é –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞"""
        advice = (
            "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n"
            "‚îÇ üé≠ –°–û–í–ï–¢–´ –ü–û –û–ü–ü–û–ù–ï–ù–¢–£ (–¥–ª—è –≤–∞—Å):  ‚îÇ\n"
            "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n"
        )
        
        for behavior_type, recommendation in behaviors.items():
            emoji = {
                '–∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω': 'üî•',
                '–ø–∞—Å—Å–∏–≤–µ–Ω': 'üò¥',
                '—Ç–∞–π—Ç–æ–≤': 'üõ°Ô∏è',
                '–Ω–∞ —Ç–∏–ª—å—Ç–µ': 'üò§',
                '–ø–æ–∫–∞–∑–∞–ª —Å–ª–∞–±–æ—Å—Ç—å': 'üò∞'
            }.get(behavior_type, 'üë§')
            
            advice += f"{emoji} **–ï—Å–ª–∏ –æ–ø–ø–æ–Ω–µ–Ω—Ç {behavior_type}**:\n   {recommendation}\n\n"
        
        return advice.rstrip()


# ===================== INTEGRATION FUNCTION =====================

def generate_improved_recommendation(analysis_result: Dict) -> str:
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ analysis_service.py
    
    Usage:
        from improved_abc_recommendations import generate_improved_recommendation
        
        recommendation = generate_improved_recommendation(analysis_result)
    """
    engine = ImprovedRecommendationEngine()
    
    # Extract data from analysis result
    current_hand = analysis_result.get('current_hand', 'high card')
    equity_data = analysis_result.get('equity', {})
    win_rate = equity_data.get('win_rate', 0)
    
    outs_data = analysis_result.get('outs_analysis', {})
    total_outs = analysis_result.get('total_outs', 0)
    
    texture_analysis = analysis_result.get('board_texture', {})
    
    # Get game state data (you'll need to pass this)
    # These should come from the GameState object
    num_opponents = analysis_result.get('num_opponents', 1)
    stage = analysis_result.get('stage', GameStage.FLOP)
    board_cards = analysis_result.get('board_cards_list', [])
    
    return engine.generate_recommendation(
        current_hand=current_hand,
        win_rate=win_rate,
        total_outs=total_outs,
        outs_breakdown=outs_data,
        texture_analysis=texture_analysis,
        num_opponents=num_opponents,
        stage=stage,
        board_cards=board_cards
    )
