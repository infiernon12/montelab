# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è YOLOX –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞ –∫–∞—Ä—Ç

## –î–∞—Ç–∞: 2025-11-13

## –ü—Ä–æ–±–ª–µ–º–∞
–ú–æ–¥–µ–ª—å YOLOX (`epoch_50_ckpt.pth`) –Ω–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∞ –∫–∞—Ä—Ç—ã, —Ö–æ—Ç—è –±—ã–ª–∞ –æ–±—É—á–µ–Ω–∞ —Å —Ö–æ—Ä–æ—à–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ (AP: 70.13%).

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### 1. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ YOLOX
**–§–∞–π–ª:** `ml/detector.py`, —Å—Ç—Ä–æ–∫–∏ 118-150

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `postprocess()` –∏–∑ `yolox.utils`
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª NMS (Non-Maximum Suppression)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ—Ç–Ω–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –¥–µ—Ç–µ–∫—Ü–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
outputs = postprocess(
    outputs,
    num_classes=self.exp.num_classes,
    conf_thre=confidence_threshold,
    nms_thre=0.45  # Standard NMS threshold for YOLOX
)
```

### 2. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ score
**–§–∞–π–ª:** `ml/detector.py`, —Å—Ç—Ä–æ–∫–∏ 124-129

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–∏–Ω–∞–ª—å–Ω—ã–π score = —Ç–æ–ª—å–∫–æ `class_probability`
- –ù–µ —É—á–∏—Ç—ã–≤–∞–ª—Å—è `objectness` score
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –¥–ª—è YOLOX: `final_score = objectness √ó class_probability`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –î–æ: class_scores, class_ids = class_probs.max(dim=-1)
# –ü–æ—Å–ª–µ: score = obj_conf * class_conf  # –∏–∑ postprocess output
```

### 3. ‚ùå –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ confidence
**–§–∞–π–ª:** `ml/detector.py`, —Å—Ç—Ä–æ–∫–∞ 106

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Ä–æ–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0.4` (40%)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è YOLOX: `0.25-0.3`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
def predict(self, frame: np.ndarray, confidence_threshold: float = 0.25):
```

### 4. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ bbox –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
**–§–∞–π–ª:** `ml/detector.py`, —Å—Ç—Ä–æ–∫–∏ 162-174

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª –∏–∑ center format (x, y, w, h)
- –ù–æ `postprocess()` —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç corner format (x1, y1, x2, y2)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# postprocess() returns: [x1, y1, x2, y2, obj_conf, class_conf, class_id]
x1, y1, x2, y2, obj_conf, class_conf, cls_id = pred

# Scale bbox back to original image size
x1 = int(x1 / ratio)
y1 = int(y1 / ratio)
x2 = int(x2 / ratio)
y2 = int(y2 / ratio)
```

### 5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª:** `ml/detector.py`, —Å—Ç—Ä–æ–∫–∏ 123-131, 148-151

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
logger.info(f"üîç Raw output stats:")
logger.info(f"   Objectness - min/max/mean")
logger.info(f"   Class probs - min/max/mean")
logger.info(f"üîç Confidence scores (obj*cls):")
logger.info(f"   Min/Max/Mean scores after NMS")
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### ml/detector.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `postprocess()` —Å NMS
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ score
- ‚úÖ –°–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ confidence: 0.4 ‚Üí 0.25
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ bbox –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `test_detector.py`

**–ó–∞–ø—É—Å–∫:**
```bash
python test_detector.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å `epoch_50_ckpt.pth`
- –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –±–µ–ª—ã–º–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞–º–∏ (–∏–º–∏—Ç–∞—Ü–∏—è –∫–∞—Ä—Ç)
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –¥–µ—Ç–µ–∫—Ç–æ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏: 0.1, 0.25, 0.4, 0.5
- –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∞—Ö

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–µ—Ç–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω:
- ‚úÖ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å 2 player cards (–≤–Ω–∏–∑—É)
- ‚úÖ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å 0-5 board cards (–≤ —Ü–µ–Ω—Ç—Ä–µ)
- ‚úÖ –í—ã–¥–∞–≤–∞—Ç—å confidence scores > 0.3-0.5
- ‚úÖ –ù–µ –≤—ã–¥–∞–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –¥–µ—Ç–µ–∫—Ü–∏–π (–±–ª–∞–≥–æ–¥–∞—Ä—è NMS)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å bbox –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

## –ß—Ç–æ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ –º–µ–Ω—è–ª–æ—Å—å)

- ‚úÖ –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (BGR‚ÜíRGB, resize, normalize)
- ‚úÖ –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–∞: 640x640
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤: 2 (BoardCard, PlayerCard)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ checkpoint
- ‚úÖ –ó–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (player/board cards)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `test_detector.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑–æ–≤–æ–π —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö –ø–æ–∫–µ—Ä–Ω–æ–≥–æ —Å—Ç–æ–ª–∞
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:
   - `confidence_threshold` (–µ—Å–ª–∏ –º–Ω–æ–≥–æ false positives/negatives)
   - `nms_thre` (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –¥–µ—Ç–µ–∫—Ü–∏–π)
   - –ó–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `_optimize_player_cards` –∏ `_optimize_board_cards`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

- –ú–æ–¥–µ–ª—å: `epoch_50_ckpt.pth` (Best AP: 0.7013)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: YOLOX-S —Å 2 –∫–ª–∞—Å—Å–∞–º–∏
- Device: CPU/CUDA (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
